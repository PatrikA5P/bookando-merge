generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ============================================
// CORE ENTITIES
// ============================================

model Organization {
  id          String   @id @default(uuid())
  name        String
  subdomain   String?  @unique
  email       String
  phone       String?
  address     String?
  city        String?
  zip         String?
  country     String   @default("CH")

  // Settings
  language    String   @default("de")
  timezone    String   @default("Europe/Zurich")
  currency    String   @default("CHF")
  taxRate     Float    @default(7.7) // Swiss VAT rate

  // License
  licenseId   String?  @unique
  license     License? @relation(fields: [licenseId], references: [id])

  // Timestamps
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  users       User[]
  customers   Customer[]
  employees   Employee[]
  courses     Course[]
  services    Service[]
  bookings    Booking[]
  invoices    Invoice[]
  locations   Location[]
  notificationSettings NotificationSettings?
  notificationTemplates NotificationTemplate[]
  calendarConnections CalendarConnection[]

  @@map("organizations")
}

model User {
  id             String   @id @default(uuid())
  email          String
  passwordHash   String
  firstName      String
  lastName       String

  // Organization
  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id])

  // Role
  roleId         String
  role           Role     @relation(fields: [roleId], references: [id])

  // Status
  status         UserStatus @default(ACTIVE)
  lastLogin      DateTime?

  // Timestamps
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  // Relations
  employee       Employee?
  devices        Device[]
  refreshTokens  RefreshToken[]

  @@unique([organizationId, email])
  @@map("users")
}

enum UserStatus {
  ACTIVE
  INACTIVE
  SUSPENDED
}

model Role {
  id          String   @id @default(uuid())
  name        String
  permissions Json     // ModulePermissions object

  users       User[]

  @@map("roles")
}

model RefreshToken {
  id        String   @id @default(uuid())
  token     String   @unique
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  expiresAt DateTime
  createdAt DateTime @default(now())

  @@map("refresh_tokens")
}

model Device {
  id        String   @id @default(uuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  fcmToken  String   @unique
  platform  DevicePlatform
  model     String?
  osVersion String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("devices")
}

enum DevicePlatform {
  IOS
  ANDROID
  WEB
}

// ============================================
// CUSTOMERS
// ============================================

model Customer {
  id             String   @id @default(uuid())
  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id])

  firstName      String
  lastName       String
  email          String
  phone          String?

  // Address
  address        String?
  zip            String?
  city           String?
  country        String?

  // Personal
  birthday       String?
  gender         String?

  // Custom Fields (JSON)
  customFields   Json?

  // Status
  status         CustomerStatus @default(ACTIVE)

  // Timestamps
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  // Relations
  bookings       Booking[]
  invoices       Invoice[]
  enrollments    Enrollment[]
  educationCards CustomerEducationCard[]

  @@unique([organizationId, email])
  @@map("customers")
}

enum CustomerStatus {
  ACTIVE
  INACTIVE
  ARCHIVED
}

// ============================================
// EMPLOYEES
// ============================================

model Employee {
  id             String   @id @default(uuid())
  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id])

  userId         String   @unique
  user           User     @relation(fields: [userId], references: [id])

  position       String
  department     String?
  hireDate       String
  exitDate       String?

  // Skills (for auto-assignment)
  skills         String[]
  qualifications String[]

  // Workload (for Round Robin balancing)
  workloadPercentage Int @default(100) // 0-100, e.g., 10 = 10%, 100 = 100%
  hourlyRate         Float?

  // Status
  status         EmployeeStatus @default(ACTIVE)

  // Timestamps
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  // Relations
  bookings       Booking[]
  timeEntries    TimeEntry[]
  shifts         Shift[]
  absences       Absence[]
  courseSessions CourseSession[]
  calendarConnections CalendarConnection[]
  organizedCourses Course[]  @relation("CourseOrganizer")

  @@map("employees")
}

enum EmployeeStatus {
  ACTIVE
  ON_LEAVE
  INACTIVE
}

model TimeEntry {
  id         String   @id @default(uuid())
  employeeId String
  employee   Employee @relation(fields: [employeeId], references: [id])

  date       String
  startTime  String
  endTime    String?
  type       TimeEntryType
  status     TimeEntryStatus

  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@map("time_entries")
}

enum TimeEntryType {
  WORK
  BREAK
  SICK
  VACATION
}

enum TimeEntryStatus {
  PENDING
  APPROVED
  REJECTED
}

model Shift {
  id         String   @id @default(uuid())
  employeeId String
  employee   Employee @relation(fields: [employeeId], references: [id])

  date       String
  type       ShiftType
  startTime  String
  endTime    String

  createdAt  DateTime @default(now())

  @@map("shifts")
}

enum ShiftType {
  EARLY
  LATE
  NIGHT
  OFF
}

model Absence {
  id           String   @id @default(uuid())
  employeeId   String
  employee     Employee @relation(fields: [employeeId], references: [id])

  type         AbsenceType
  startDate    String
  endDate      String
  reason       String?
  status       AbsenceStatus

  requestedAt  DateTime @default(now())

  @@map("absences")
}

enum AbsenceType {
  VACATION
  SICK
  PERSONAL
  OTHER
}

enum AbsenceStatus {
  PENDING
  APPROVED
  REJECTED
}

// ============================================
// COURSES & ACADEMY
// ============================================

model Course {
  id             String   @id @default(uuid())
  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id])

  // Basic Info
  title          String   // Course title
  description    String?  @db.Text // Rich text description
  coverImage     String?

  // Categorization
  categoryId     String?
  category       Category? @relation(fields: [categoryId], references: [id])
  tags           CourseTag[] // Relation to tags for better management

  // Type & Visibility
  type           CourseType
  visibility     CourseVisibility
  status         CourseStatus @default(DRAFT) // form.status

  // Settings
  notifyParticipants Boolean @default(true) // form.notify_participants
  isRecurring        Boolean @default(false) // form.is_recurring

  // Booking Window
  bookingStartsImmediately Boolean @default(false) // form.booking_starts_immediately
  bookingStartDate         String?  // form.booking_start_date
  bookingStartTime         String?  // form.booking_start_time
  bookingClosesOnStart     Boolean @default(true) // form.booking_closes_on_start
  bookingEndDate           String?  // form.booking_end_date
  bookingEndTime           String?  // form.booking_end_time

  // Location (can be overridden per session)
  defaultLocationId  String?
  defaultLocation    Location? @relation(fields: [defaultLocationId], references: [id])
  customLocation     String?  // form.custom_location (freetext)

  // Organization
  organizerId    String?
  organizer      Employee? @relation("CourseOrganizer", fields: [organizerId], references: [id])
  teamIds        String[]  // form.team_ids (Employee IDs)

  // Pricing
  price          Float    // form.price (base price)
  currency       String   @default("CHF")

  // Deposit
  depositEnabled Boolean  @default(false) // form.deposit_enabled
  depositAmount  Float?   // form.deposit_amount

  // Capacity & Rules
  capacity               Int?     // form.capacity (max participants)
  allowGroupBooking      Boolean  @default(false) // form.allow_group_booking
  allowRepeatBooking     Boolean  @default(true) // form.allow_repeat_booking
  closeOnMinimumEnabled  Boolean  @default(false) // form.close_on_minimum_enabled
  closeOnMinimumValue    Int?     // form.close_on_minimum_value
  limitExtraEnabled      Boolean  @default(false) // form.limit_extra_enabled
  limitExtraValue        Int?     // form.limit_extra_value

  // Content
  curriculum     Json?    // Array of Topics

  // Media
  gallery        String[] // form.gallery[] (image URLs)

  // Appearance
  colorMode      String   @default("preset") // "preset" or "custom"
  colorValue     String   @default("#FFD500") // form.color_value (hex or preset name)

  // Certificate
  certificate    Boolean  @default(false)
  certificateTemplate String?

  // Metadata
  duration       Int?     // Total duration in hours
  difficulty     String?

  // Website & Display
  showOnWebsite  Boolean  @default(true) // form.show_on_website
  published      Boolean  @default(false)

  // Advanced Features
  waitlistEnabled    Boolean @default(false) // form.waitlist_enabled (Pro feature)
  cancellationLeadTime Int? // form.cancellation_lead_time (minutes before start)
  redirectUrl        String?  // form.redirect_url (post-booking redirect)

  // Payment
  paymentLinkEnabled Boolean @default(false) // form.payment_link_enabled
  paymentOnSite      Boolean @default(true)  // form.payment_on_site

  // Online Features
  googleMeetEnabled  Boolean @default(false) // form.google_meet_enabled

  // Timestamps
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  // Relations
  sessions       CourseSession[]
  enrollments    Enrollment[]
  services       Service[]

  @@map("courses")
}

enum CourseType {
  ONLINE
  IN_PERSON
  BLENDED
}

enum CourseVisibility {
  PUBLIC
  PRIVATE
  INTERNAL
}

enum CourseStatus {
  DRAFT      // Not yet published
  ACTIVE     // Published and accepting bookings
  FULL       // Fully booked
  CANCELLED  // Cancelled
  COMPLETED  // Course finished
  ARCHIVED   // Hidden from view
}

model Tag {
  id             String   @id @default(uuid())
  organizationId String
  name           String
  color          String?  // Hex color for display
  description    String?

  courses        CourseTag[]

  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@unique([organizationId, name])
  @@map("tags")
}

model CourseTag {
  courseId String
  course   Course @relation(fields: [courseId], references: [id], onDelete: Cascade)

  tagId    String
  tag      Tag    @relation(fields: [tagId], references: [id], onDelete: Cascade)

  @@id([courseId, tagId])
  @@map("course_tags")
}

model CourseSession {
  id         String   @id @default(uuid())
  courseId   String
  course     Course   @relation(fields: [courseId], references: [id])

  date       String
  startTime  String
  endTime    String

  // Instructor
  instructorId String?
  instructor   Employee? @relation(fields: [instructorId], references: [id])

  // Location
  locationId String?
  location   Location? @relation(fields: [locationId], references: [id])
  roomId     String?
  room       Room?     @relation(fields: [roomId], references: [id])

  // Capacity
  maxParticipants    Int
  currentEnrollment  Int      @default(0)

  // Status
  status     SessionStatus

  // Timestamps
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  // Relations
  bookings   Booking[]

  @@map("course_sessions")
}

enum SessionStatus {
  SCHEDULED
  FULL
  CANCELLED
  COMPLETED
}

model Enrollment {
  id         String   @id @default(uuid())
  customerId String
  customer   Customer @relation(fields: [customerId], references: [id])
  courseId   String
  course     Course   @relation(fields: [courseId], references: [id])

  // Progress
  progress   Json     // Array of completed lessons
  completed  Boolean  @default(false)
  completedAt DateTime?

  // Certificate
  certificateIssued Boolean  @default(false)
  certificateUrl    String?

  enrolledAt DateTime @default(now())

  @@unique([customerId, courseId])
  @@map("enrollments")
}

model EducationCard {
  id             String   @id @default(uuid())
  title          String
  description    String?

  chapters       Json     // Array of chapters
  gradingConfig  Json     // Grading configuration
  automation     Json     // Automation rules

  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  assignments    CustomerEducationCard[]
  services       Service[]

  @@map("education_cards")
}

model CustomerEducationCard {
  id             String   @id @default(uuid())
  customerId     String
  customer       Customer @relation(fields: [customerId], references: [id])
  cardId         String
  card           EducationCard @relation(fields: [cardId], references: [id])

  progress       Json     // Progress tracking
  completed      Boolean  @default(false)

  assignedAt     DateTime @default(now())
  completedAt    DateTime?

  @@unique([customerId, cardId])
  @@map("customer_education_cards")
}

// ============================================
// SERVICES & OFFERS
// ============================================

model Service {
  id             String   @id @default(uuid())
  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id])

  name           String
  description    String?
  category       ServiceCategory @default(OTHER)

  // Event Type (ONE_ON_ONE, GROUP, etc.)
  eventType      String @default("ONE_ON_ONE")

  // Assignment Strategy
  assignmentStrategy String @default("WORKLOAD_BALANCE")

  // Pricing
  price          Float
  currency       String   @default("CHF")

  // Details
  duration       Int      // minutes (required)
  maxParticipants Int?

  // Requirements
  requiresLicense Boolean @default(false)
  isOnline        Boolean @default(false)

  // Booking Rules
  minNoticeHours Int?
  maxAdvanceDays Int?

  // Dynamic Pricing
  dynamicPricing Boolean  @default(false)
  pricingRuleId  String?
  pricingRule    PricingRule? @relation(fields: [pricingRuleId], references: [id])

  // Linked Content
  linkedCourseId       String?
  linkedCourse         Course? @relation(fields: [linkedCourseId], references: [id])
  linkedEducationCardId String?
  linkedEducationCard   EducationCard? @relation(fields: [linkedEducationCardId], references: [id])

  // Form
  formTemplateId String?
  formTemplate   FormTemplate? @relation(fields: [formTemplateId], references: [id])

  // Old Category (keeping for backward compatibility)
  categoryId     String?
  categoryModel       Category? @relation(fields: [categoryId], references: [id])

  // Custom Fields
  customFields   Json?

  // Status
  status         ServiceStatus @default(ACTIVE)

  // Timestamps
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  // Relations
  bookings       Booking[]
  extras         ServiceExtra[]

  @@map("services")
}

enum ServiceCategory {
  DRIVING_LESSON // Auto/Motorrad Fahrstunden
  THEORY         // VKU, Theorie
  FIRST_AID      // Nothelferkurs
  ADVANCED_TRAINING // 2-Phasen, Offroad
  EXAM           // PrÃ¼fungen
  OTHER          // Sonstiges
}

enum ServiceStatus {
  ACTIVE
  INACTIVE
  ARCHIVED
}

enum ServiceType {
  SERVICE
  ONLINE_COURSE
  EVENT
}

model Category {
  id          String   @id @default(uuid())
  name        String
  description String?
  color       String?
  image       String?

  services    Service[]
  courses     Course[]

  @@map("categories")
}

model ServiceExtra {
  id        String   @id @default(uuid())
  serviceId String
  service   Service  @relation(fields: [serviceId], references: [id])

  name      String
  description String?
  price     Float
  priceType ExtraPriceType

  @@map("service_extras")
}

enum ExtraPriceType {
  FIXED
  PERCENTAGE
}

model PricingRule {
  id          String   @id @default(uuid())
  name        String
  type        PricingRuleType

  config      Json     // Rule configuration

  services    Service[]

  @@map("pricing_rules")
}

enum PricingRuleType {
  EARLY_BIRD
  LAST_MINUTE
  SEASONAL
  DEMAND
  HISTORY
}

model FormTemplate {
  id          String   @id @default(uuid())
  name        String
  description String?
  elements    Json     // Array of FormElements
  active      Boolean  @default(true)

  services    Service[]

  @@map("form_templates")
}

// ============================================
// BOOKINGS
// ============================================

model Booking {
  id             String   @id @default(uuid())
  bookingNumber  String   @unique
  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id])

  // Customer
  customerId     String
  customer       Customer @relation(fields: [customerId], references: [id])

  // Service
  serviceId      String
  service        Service  @relation(fields: [serviceId], references: [id])

  // Session (for courses)
  sessionId      String?
  session        CourseSession? @relation(fields: [sessionId], references: [id])

  // Date & Time
  scheduledDate  String
  scheduledTime  String

  // Participants
  participants   Int      @default(1)
  notes          String?

  // Pricing
  basePrice      Float
  appliedPricing Json?    // DynamicPricingResult
  extras         Json[]   // BookingExtras
  totalPrice     Float

  // Assignment
  employeeId     String?
  employee       Employee? @relation(fields: [employeeId], references: [id])

  // Resources
  resourceAllocation Json?

  // Form
  formResponses  Json[]

  // Status
  status         BookingStatus
  paymentStatus  PaymentStatus

  // Invoice
  invoiceId      String?  @unique
  invoice        Invoice? @relation(fields: [invoiceId], references: [id])

  // Timestamps
  createdAt      DateTime @default(now())
  confirmedAt    DateTime?
  paidAt         DateTime?
  completedAt    DateTime?
  cancelledAt    DateTime?
  updatedAt      DateTime @updatedAt

  // Relations
  calendarEvents CalendarEvent[]

  @@map("bookings")
}

enum BookingStatus {
  PENDING
  CONFIRMED
  PAID
  COMPLETED
  CANCELLED
  NO_SHOW
}

enum PaymentStatus {
  PENDING
  PAID
  PARTIALLY_PAID
  REFUNDED
}

// ============================================
// FINANCE
// ============================================

model Invoice {
  id             String   @id @default(uuid())
  invoiceNumber  String   @unique
  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id])

  // Customer
  customerId     String
  customer       Customer @relation(fields: [customerId], references: [id])

  // Booking
  bookingId      String?
  booking        Booking?

  // Amounts
  subtotal       Float
  taxAmount      Float
  totalAmount    Float
  amountPaid     Float    @default(0)
  amountDue      Float
  currency       String   @default("CHF")

  // Dates
  issueDate      String
  dueDate        String
  notes          String?

  // Payment
  status         InvoiceStatus
  sentAt         DateTime?
  paidAt         DateTime?
  cancelledAt    DateTime?

  // Dunning
  dunningLevel   Int      @default(0)
  lastReminderAt DateTime?

  // Items
  items          InvoiceItem[]

  // Relations
  payments       Payment[]

  // Timestamps
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@map("invoices")
}

model InvoiceItem {
  id          String  @id @default(uuid())
  invoiceId   String
  invoice     Invoice @relation(fields: [invoiceId], references: [id], onDelete: Cascade)

  description String
  quantity    Int
  unitPrice   Float
  taxRate     Float
  totalPrice  Float
  sortOrder   Int     @default(0)

  @@map("invoice_items")
}

model Payment {
  id             String   @id @default(uuid())
  invoiceId      String
  invoice        Invoice  @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
  organizationId String

  amount         Float
  paymentDate    String
  method         String   @default("MANUAL") // MANUAL, STRIPE, PAYPAL, etc.
  status         String   @default("COMPLETED")
  transactionId  String?

  createdAt      DateTime @default(now())

  @@map("payments")
}

enum InvoiceStatus {
  DRAFT
  SENT
  PAID
  PARTIALLY_PAID
  OVERDUE
  CANCELLED
}

// ============================================
// RESOURCES
// ============================================

model Location {
  id             String   @id @default(uuid())
  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id])

  name           String
  address        String?
  city           String?
  zip            String?
  country        String?

  rooms          Room[]
  courseSessions CourseSession[]
  courses        Course[] // Default location for courses

  @@map("locations")
}

model Room {
  id         String   @id @default(uuid())
  locationId String
  location   Location @relation(fields: [locationId], references: [id])

  name       String
  capacity   Int
  equipment  String[]

  courseSessions CourseSession[]

  @@map("rooms")
}

// ============================================
// LICENSING
// ============================================

model License {
  id             String   @id @default(uuid())
  organization   Organization?

  tier           LicenseTier
  status         LicenseStatus

  // Platforms
  platforms      Json     // PlatformAccess object

  // Modules
  enabledModules Json     // ModuleCapabilities object

  // Limits
  limits         Json     // LicenseLimits object

  // Features
  features       Json     // LicenseFeatures object

  // Billing
  validFrom      DateTime
  validUntil     DateTime
  billingCycle   BillingCycle

  price          Float
  currency       String   @default("CHF")

  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@map("licenses")
}

enum LicenseTier {
  STARTER
  PROFESSIONAL
  ENTERPRISE
}

enum LicenseStatus {
  ACTIVE
  TRIAL
  SUSPENDED
  CANCELLED
  EXPIRED
}

enum BillingCycle {
  MONTHLY
  YEARLY
}

// ============================================
// NOTIFICATIONS
// ============================================

model NotificationSettings {
  id             String   @id @default(uuid())
  organizationId String   @unique
  organization   Organization @relation(fields: [organizationId], references: [id])

  // Email Provider
  emailProvider  String?  // SMTP, SENDGRID, AWS_SES
  emailConfig    Json?

  // SMS Provider
  smsProvider    String?  // TWILIO, NEXMO
  smsConfig      Json?

  // WhatsApp Provider
  whatsappProvider String? // WHATSAPP_BUSINESS, TWILIO
  whatsappConfig   Json?

  // Push Provider
  pushProvider   String?  // FIREBASE, ONESIGNAL
  pushConfig     Json?

  // Enabled Events
  enabledEvents  Json     // Map of event -> { enabled, channels, delayMinutes }

  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@map("notification_settings")
}

model NotificationTemplate {
  id             String   @id @default(uuid())
  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id])

  event          String   // NotificationEvent
  channel        String   // NotificationChannel (EMAIL, SMS, WHATSAPP, PUSH)
  subject        String?  // For email
  body           String   @db.Text // Template with {{placeholders}}
  isActive       Boolean  @default(true)

  // Filters
  serviceCategories String[] // Apply to specific categories
  serviceIds        String[] // Apply to specific services

  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@map("notification_templates")
}

model NotificationLog {
  id             String   @id @default(uuid())
  organizationId String

  event          String   // NotificationEvent
  channel        String   // NotificationChannel
  recipient      String   // Email, phone, or push token
  subject        String?
  body           String   @db.Text
  status         String   // SENT, FAILED, PENDING
  errorMessage   String?

  sentAt         DateTime?
  createdAt      DateTime @default(now())

  @@map("notification_logs")
}

// ============================================
// CALENDAR INTEGRATION
// ============================================

model CalendarConnection {
  id             String   @id @default(uuid())
  employeeId     String
  employee       Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id])

  provider       String   // GOOGLE, MICROSOFT, APPLE
  isActive       Boolean  @default(true)

  // OAuth Tokens (encrypted in application layer)
  accessToken    String   @db.Text
  refreshToken   String   @db.Text
  tokenExpiry    DateTime

  // Provider Info
  calendarId     String
  email          String

  // Sync Settings
  syncDirection  String   @default("TWO_WAY") // READ_ONLY, WRITE_ONLY, TWO_WAY
  autoCreateEvents Boolean @default(true)
  autoUpdateEvents Boolean @default(true)
  autoDeleteEvents Boolean @default(true)

  lastSyncedAt   DateTime?

  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  // Relations
  events         CalendarEvent[]

  @@map("calendar_connections")
}

model CalendarEvent {
  id              String   @id @default(uuid())
  connectionId    String
  connection      CalendarConnection @relation(fields: [connectionId], references: [id], onDelete: Cascade)

  bookingId       String?
  booking         Booking? @relation(fields: [bookingId], references: [id], onDelete: SetNull)

  externalEventId String
  title           String
  description     String?
  startTime       DateTime
  endTime         DateTime
  location        String?

  lastSyncedAt    DateTime
  syncStatus      String   @default("SYNCED") // SYNCED, PENDING, FAILED
  syncError       String?

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@map("calendar_events")
}

// ============================================
// WORDPRESS INTEGRATION
// ============================================

model WordPressSite {
  id             String   @id @default(uuid())
  organizationId String

  siteUrl        String
  apiKey         String

  webhooksEnabled Boolean  @default(true)
  webhookUrl      String?
  webhookSecret   String?

  cacheDuration   Int      @default(900) // 15 minutes in seconds

  lastSync        DateTime?

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@map("wordpress_sites")
}
