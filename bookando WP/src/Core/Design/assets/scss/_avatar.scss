@use 'sass:map';
@use 'variables' as *;

/* =========================================================
   Avatar – Wrapper (.bookando-avatar) + BEM-Innereien
   ========================================================= */
.bookando-avatar {
  position: relative;
  display: inline-flex;
  align-items: center;
  justify-content: center;

  // Defaultgröße = md
  width:  map.get($bookando-avatar-sizes, md);
  height: map.get($bookando-avatar-sizes, md);

  border-radius: $bookando-radius-circle;
  background: $bookando-secondary;
  color: $bookando-text-dark;
  font-weight: $bookando-font-weight-bold;
  user-select: none;
  box-shadow: 0 1px 4px rgba(16,40,60,0.07);

  // Badges dürfen leicht überstehen
  overflow: visible;

  // Größen-Modifier
  @each $name, $size in $bookando-avatar-sizes {
    &--#{$name} { width: $size; height: $size; }
  }

  /* --- Bild füllt den Wrapper vollständig --- */
  &__img {
    width: 100%;
    height: 100%;
    display: block;
    object-fit: cover;
    aspect-ratio: 1 / 1;
    border-radius: $bookando-radius-circle;
    background: $bookando-secondary;
  }

  /* --- Initialen (Fallback) --- */
  &__initials {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    background: $bookando-primary-light;
    color: $bookando-primary;
    font-weight: $bookando-font-weight-bold;
    letter-spacing: .02em;
    text-transform: uppercase;
    border-radius: inherit;
  }

  /* --- Hover-Overlay (Ausgrauen) --- */
  &__overlay {
    position: absolute;
    inset: 0;
    border-radius: inherit;
    background: rgba(16,24,40,.35);
    opacity: 0;
    transition: opacity .18s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    // Overlay selbst lässt Klicks durch; Buttons haben pointer-events:auto
    pointer-events: none;
    z-index: 1;
  }

  /* --- Buttons (zentral / Ecke) --- */
  &__btn {
    position: absolute;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    border: 0;
    background: transparent;
    padding: 0;
    cursor: pointer;
    color: inherit;
    // Buttons dürfen geklickt werden, obwohl Overlay pointer-events:none ist
    pointer-events: auto;
    z-index: 2;

    &:focus { outline: none; }
    &:focus-visible { outline: 2px solid rgba(16,24,40,.35); outline-offset: 2px; }
  }

  // Center-Button (Upload)
  &__btn--center {
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) scale(.92);
    width: 42px;
    height: 42px;
    border-radius: 999px;
    background: $bookando-white;
    border: 1px solid rgba(16,24,40,.08);
    box-shadow: 0 8px 24px rgba(16,40,60,.18);
    opacity: 0;
    transition: opacity .16s ease, transform .16s ease, background .12s ease;
  }

  // Corner-Button (Trash)
  &__btn--corner {
    top: -10px;
    left: -10px;
    width: 36px;
    height: 36px;
    border-radius: 999px;
    background: $bookando-gray-400;
    color: $bookando-white;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 6px 16px rgba(16,40,60,.20);
    border: 2px solid $bookando-white;
    opacity: 0;
    transform: scale(.92);
    transition: opacity .16s ease, transform .16s ease, background .12s ease;

    &:hover { background: $bookando-gray-600; }
  }

  /* --- Interaktionen --- */
  &--interactive:hover .bookando-avatar__overlay { opacity: 1; }
  &--interactive:hover .bookando-avatar__btn--center,
  &--interactive:hover .bookando-avatar__btn--corner {
    opacity: 1;
    transform: translate(-50%, -50%) scale(1); // center
  }
  &--interactive:hover .bookando-avatar__btn--corner { transform: scale(1); }

  /* --- Empty-State --- */
  &--empty .bookando-avatar__overlay { opacity: 1; }
  &--empty .bookando-avatar__btn--center {
    opacity: 1;
    transform: translate(-50%, -50%) scale(1);
  }
  &--empty .bookando-avatar__btn--corner { display: none; }
}

/* =========================================================
   Standalone-Bild (ohne Wrapper)
   ========================================================= */
.bookando-avatar-img {
  width:  map.get($bookando-avatar-sizes, md);
  height: map.get($bookando-avatar-sizes, md);
  display: block;
  object-fit: cover;
  aspect-ratio: 1 / 1;
  border-radius: $bookando-radius-circle;
  background: $bookando-secondary;
}
@each $name, $size in $bookando-avatar-sizes {
  .bookando-avatar-img--#{$name} { width: $size; height: $size; }
}

/* Optional: Bild „contain“ statt „cover“ */
.bookando-avatar--contain > .bookando-avatar__img {
  object-fit: contain;
  background: $bookando-bg-light;
}

/* =========================================================
   NEU: Farbrand & Farbtupfer
   ========================================================= */

/* Ring: nutzt CSS-Variable --avatar-ring */
.bookando-avatar--ring {
  /* bestehender Shadow + zusätzlicher Ring */
  box-shadow:
    0 0 0 4px var(--avatar-ring, #12DE9D),
    0 1px 4px rgba(16,40,60,0.07);
}

/* Externer Farbtupfer-Button (neben dem Avatar platzierbar) */
.bookando-avatar-swatch {
  width: 36px;
  height: 36px;
  border-radius: 999px;
  border: 2px solid $bookando-white;
  box-shadow: 0 6px 16px rgba(16,40,60,.20);
  background: var(--avatar-ring, #12DE9D);
  cursor: pointer;
  display: inline-flex;
  align-items: center;
  justify-content: center;

  &:focus-visible { outline: 2px solid rgba(16,24,40,.35); outline-offset: 2px; }
}
