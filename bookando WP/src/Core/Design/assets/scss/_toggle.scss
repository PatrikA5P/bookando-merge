@use 'sass:color';
@use 'variables' as *;

/* Größen-Utilities */
.liquid-toggle--xs { --width: 48;  --height: 24; --border: 4px; }
.liquid-toggle--sm { --width: 64;  --height: 32; --border: 5px; }  /* default */
.liquid-toggle--md { --width: 90;  --height: 40; --border: 6px; }
.liquid-toggle--lg { --width: 120; --height: 52; --border: 6px; }

/* ============================================================================
   Liquid Glass Toggle – 1:1 Verhalten wie Vorlage, Tropfen als echtes Glas
============================================================================ */
.liquid-toggle {
  /* Basissize (per Utility überschreibbar) */
  --width: 64; --height: 32; --border: 5px;

  /* Bewegung/Farbe */
  --complete: 0;            /* 0..100 – GSAP setzt das */
  --transition: .2s;
  --ease: ease-out;

  /* OFF/ON-Farben + weicher Übergang */
  --unchecked: hsl(218 8% 81%);
  /* Farbverlauf wie in der Vorlage – HSL über complete ableiten */
  --checked: hsl(
    var(--hue, 144),
    calc((8 + (var(--complete) / 100 * 92)) * 1%),
    calc((81 - (var(--complete) / 100 * (81 - 43))) * 1%)
  );
  /* Track-Farbe weich zwischen off/on mischen */
  --accent: color-mix(
    in oklch,
    var(--unchecked) calc(100% - (var(--complete) * 1%)),
    var(--checked)   calc(      (var(--complete) * 1%))
  );

  height: calc(var(--height) * 1px);
  width:  calc(var(--width)  * 1px);
  border-radius: 100px;
  border: 0; padding: 0;
  position: relative;
  background: transparent;
  cursor: pointer;
  overflow: visible;
  container-type: inline-size;  /* für 100cqi */
  transition: outline var(--transition) var(--ease);
  outline-offset: 2px;
  -webkit-tap-highlight-color: transparent;

  &:focus-visible { outline: 4px solid color-mix(in oklch, var(--accent), transparent); }
  &:active { outline: none; }
  &[data-active="true"]:focus-visible { outline: 4px solid transparent; }

  /* Bounce-Kurve wie Vorlage */
  &:is(:active, [data-active="true"]) {
    --transition: .6s;
    --ease: linear(
      0 0%,
      0.6091 3.69%,
      1.0259 7.24%,
      1.1733 9.05%,
      1.283 10.92%,
      1.3562 12.87%,
      1.3948 14.95%,
      1.4014 16.03%,
      1.3999 17.16%,
      1.3731 19.64%,
      1.3202 22.27%,
      1.1394 29.39%,
      1.0582 33.17%,
      0.9943 37.45%,
      0.9734 39.64%,
      0.9593 41.92%,
      0.9505 45.08%,
      0.9517 48.7%,
      0.9924 63.02%,
      1.0046 71.2%,
      1.0061 78.24%,
      1 100%
    );
  }

  /* ------------------------------ Glas-Track ------------------------------ */
  &::before {
    content: '';
    position: absolute; inset: 0; border-radius: 100px;
    background-color: rgba($bookando-white, .24);
    background-image:
      linear-gradient(180deg, rgba($bookando-white,.55), rgba($bookando-white,.20)),
      color-mix(in srgb, var(--accent) 8%, transparent);
    border: 1px solid color-mix(in srgb, var(--accent) 36%, rgba(0,0,0,.10));
    box-shadow: 0 10px 24px rgba(16,40,60,.14);
    backdrop-filter: blur(14px) saturate(140%);
    -webkit-backdrop-filter: blur(14px) saturate(140%);
  }
  &::after {
    content: '';
    position: absolute; inset: 0; border-radius: 100px; pointer-events: none;
    box-shadow:
      inset 1px 1px 0 rgba($bookando-white,.38),
      inset 0 0 6px rgba($bookando-white,.18);
    background:
      radial-gradient(130% 80% at -10% -10%, rgba($bookando-white,.18), transparent 60%),
      radial-gradient(130% 80% at 110% -10%, rgba($bookando-white,.08), transparent 55%);
    mix-blend-mode: soft-light;
  }

  /* -------------------------- Knockout (Mask) ---------------------------- */
  .knockout {
    position: absolute; inset: 0;
    height: calc(var(--height) * 1px);
    width:  calc(var(--width)  * 1px);
    border-radius: 100px;
    filter: url(#remove-black);   /* WICHTIG: diese Filterversion! */
    will-change: filter, transform;
    transform: translate3d(0,0,0);
    pointer-events: none;
    z-index: 1;
  }

  .indicator--masked {
    position: absolute; top: 50%; left: 50%;
    height: 100%; width: 100%;
    border-radius: 100px;
    translate: -50% -50%;
    container-type: inline-size;
    background: var(--accent);

    .mask {
      position: absolute; top: 50%; left: var(--border);
      height: calc(100% - (2 * var(--border)));
      width:  calc(60%  - (2 * var(--border)));
      background: #000;              /* wird via filter vollständig entfernt */
      border-radius: 100px;
      translate: calc(
        (var(--complete) / 100) * (100cqi - 60cqi - (0 * var(--border)))
      ) -50%;
      transition-property: height, width, margin, scale;
      transition-duration: var(--transition);
      transition-timing-function: var(--ease);
      will-change: height, width, margin;
    }
  }

  /* ------------------------- Flüssigkeit/“Goo” --------------------------- */
  .wrapper {
    position: absolute; inset: 0; border-radius: 100px;
    clip-path: inset(0 0 0 0 round 100px);
    filter: blur(6px);
    transition: filter var(--transition) var(--ease);
    z-index: 2;
  }
  .liquids {
    position: absolute; inset: 0;
    transform: translate3d(0,0,0);
    border-radius: 100px;
    overflow: hidden;
    filter: url(#goo);

    .liquid__shadow {
      position: absolute; inset: 0; border-radius: 100px;
      box-shadow:
        inset 0 0 3px 4px var(--accent),
        inset calc(((var(--complete) / 100) * 8px) + -4px) 0 3px 4px var(--accent);
      transition: box-shadow calc(var(--transition) * .5) ease-out;
    }

    /* WICHTIG: Im Tropfen kein Voll-Fill mehr → transparent/tinted.
       So „sieht“ man den farbigen Track darunter durch das Glas. */
    .liquid__track {
      height: calc((var(--height) * 1px) - (0 * var(--border)));
      width:  calc((var(--width)  * 1px) - (0 * var(--border)));
      background: color-mix(in srgb, var(--accent) 35%, transparent);
      border-radius: 100px;
      position: absolute; top: 50%; left: 0;
      translate: calc(
        (var(--complete) / 100) * (100cqi - 100% - (6 * var(--border)))
      ) -50%;
      transition: height var(--transition) var(--ease),
                  width  var(--transition) var(--ease),
                  left   var(--transition) var(--ease),
                  background calc(var(--transition) * .5) ease-out;
    }
  }

  /* ------------------------------ Tropfen (Glas) ------------------------- */
  .indicator__liquid {
    position: absolute;
    top: 50%; left: var(--border);
    height: calc(100% - (2 * var(--border)));
    width:  calc(60%  - (2 * var(--border)));
    border-radius: 100px;
    container-type: inline-size;
    translate: calc(
      (var(--complete) / 100) * (100cqi - 100% - (2 * var(--border)))
    ) -50%;
    /* **Glaseffekt**: nimmt Hintergrundfarbe an */
    background: transparent;
    backdrop-filter: blur(8px) saturate(160%) contrast(1.05);
    -webkit-backdrop-filter: blur(8px) saturate(160%) contrast(1.05);
    transition: scale var(--transition) var(--ease);
    z-index: 3;

    /* innerer Schatten – Tiefe des Glases */
    .shadow {
      opacity: .75;
      position: absolute; inset: 0; border-radius: 100px;
      box-shadow:
        1px -1px 2px hsl(0 0% 100% / .45) inset,
        0 -1px 2px hsl(0 0% 100% / .45) inset,
        -1px -1px 2px hsl(0 0% 100% / .45) inset,
        1px 1px 2px hsl(0 0% 30% / .40) inset,
        -8px 4px 10px -6px hsl(0 0% 30% / .25) inset,
        -1px 1px 6px hsl(0 0% 30% / .25) inset,
        -1px -1px 8px hsl(0 0% 60% / .15),
        1px 1px 2px hsl(0 0% 30% / .12),
        2px 2px 6px hsl(0 0% 30% / .12);
      transition: opacity var(--transition) var(--ease);
      pointer-events: none;
    }

    /* **Glanz/Spiegelungen** – nur Highlights, KEIN deckendes Weiß */
    .cover {
      position: absolute; inset: 0; border-radius: 100px;
      background:
        radial-gradient(120% 90% at 18% 12%, rgba(255,255,255,.85) 0 18%, transparent 60%),
        radial-gradient(120% 75% at 88% 8%,  rgba(255,255,255,.55) 0 10%, transparent 55%),
        radial-gradient(120% 100% at 50% 120%, rgba(255,255,255,.22) 0 10%, transparent 30%);
      mix-blend-mode: screen;
      opacity: .85;
      transition: opacity var(--transition) var(--ease);
      pointer-events: none;
    }
  }

  /* wenn "an" und nicht aktiv → Spur rechts anlegen (wie Vorlage) */
  &[aria-pressed='true']:not([data-active='true']) .liquid__track { left: calc(var(--border) * 6); }

  /* aktive Glas-/Bounce-Phase – gleiche Werte wie Vorlage */
  &:is(:active, [data-active='true']) {
    .indicator--masked .mask {
      height: calc((100% - (2 * var(--border))) * 1.65);
      width:  calc((60%  - (2 * var(--border))) * 1.65);
      margin-left: calc((60% - (2 * var(--border))) * -0.325);
    }
    .indicator__liquid { scale: 1.65; }
    .wrapper { filter: blur(0); }
    /* bei Drag weniger Deckkraft → stärkere „Brechung“ */
    .indicator__liquid .cover  { opacity: .40; }
    .indicator__liquid .shadow { opacity: 1; }
    .indicator__liquid .liquid__track {
      left: calc(var(--border) * 3);
      height: calc((var(--height) * 1px) - (6 * var(--border)));
    }
  }
}

/* PurgeCSS safelist:
   liquid-toggle, liquid-toggle--xs, liquid-toggle--sm, liquid-toggle--md, liquid-toggle--lg,
   indicator, indicator--masked, indicator__liquid, knockout, mask, wrapper,
   liquids, liquid__shadow, liquid__track, sr-only
*/
