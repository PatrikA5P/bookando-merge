@use 'sass:color';
@use 'variables' as *;
@use 'mixins' as *;

// Alert-Styles importieren, damit Platzhalter verfügbar sind
@use 'alert';

// Adminbar-Höhe definieren
$admin-bar-height-desktop: 32px;
$admin-bar-height-mobile: 46px;

// =============================
// Globale Transitions (statt <style> in Vue)
// =============================
.bookando-fade-enter-active,
.bookando-fade-leave-active { transition: opacity .15s ease; }
.bookando-fade-enter-from,
.bookando-fade-leave-to { opacity: 0; }

// =============================
// BLOCKIERENDES MODAL (AppModal)
// =============================
.bookando-modal {
  position: fixed;
  z-index: 10000;
  inset: 0;
  top: var(--bookando-modal-offset, 50px); // Desktop-Offset; auf Mobile wird er auf 0 gesetzt
  display: flex;
  justify-content: center;
  align-items: center;
  background: rgba($bookando-black, 0.38); // Abdunkelung
  transition: background 0.21s;

  @media (max-width: $bookando-breakpoint-md) {
    top: 0; // Mobil volle Höhe
  }

  &.hidden { display: none; }

  &__content {
    position: relative;
    background: $bookando-white;
    border-radius: $bookando-radius;
    box-shadow: 0 8px 32px rgba(16,40,60,0.15);

    // Responsive Padding via clamp
    padding: clamp($bookando-spacing-md, 1.2vw + #{$bookando-spacing-sm}, $bookando-spacing-xl)
             clamp($bookando-spacing-sm, 1.6vw + #{$bookando-spacing-sm}, $bookando-spacing-lg);

    // Responsives Sizing
    min-width: min(92vw, 360px);
    max-width: min(96vw, 640px);
    max-height: 88vh;
    overflow-y: auto;

    animation: fadeInModal 0.25s cubic-bezier(.19,1,.22,1);

    @media (max-width: $bookando-breakpoint-md) {
      max-height: 94vh;
    }
  }

  &__close {
    position: absolute;
    top: $bookando-spacing-md;
    right: $bookando-spacing-md;
    background: transparent;
    border: none;
    color: $bookando-text-muted;
    font-size: 1.75em;
    cursor: pointer;
    transition: color 0.15s;
    z-index: 1;
    &:hover { color: $bookando-danger; }
  }

  &__header {
    font-size: $bookando-font-size-lg;
    font-weight: 700;
    margin-bottom: $bookando-spacing-md;
    color: $bookando-heading-color;
    display: flex;
    align-items: center;
    gap: $bookando-spacing-xs;
  }

  &__footer {
    margin-top: $bookando-spacing-lg;
    display: flex;
    justify-content: flex-end;
    gap: $bookando-spacing-sm;

    @media (max-width: $bookando-breakpoint-md) {
      flex-direction: column;
      align-items: stretch;
      gap: $bookando-spacing-xs;
    }
  }
}

@keyframes fadeInModal {
  from { opacity: 0; transform: translateY(-22px) scale(0.98); }
  to   { opacity: 1; transform: translateY(0)      scale(1); }
}

// Optional: Slide-in Modal (Sidepanel)
.bookando-modal--slidein {
  align-items: flex-end;

  .bookando-modal__content {
    width: 100vw;
    min-width: unset;
    border-radius: $bookando-radius $bookando-radius 0 0;
    animation: slideInModal 0.32s cubic-bezier(.19,1,.22,1);
  }
}

@keyframes slideInModal {
  from { opacity: 0; transform: translateY(120px); }
  to   { opacity: 1; transform: translateY(0); }
}

// Motion-Reduktion
@media (prefers-reduced-motion: reduce) {
  .bookando-modal__content { animation: none; }
}

// ==========================================
// NOTICE (overlay-frei) – liquid glass (pill)
// ==========================================
.bookando-notice {
  position: fixed;
  top: 100px; left: 0; right: 0;
  z-index: 20000;
  display: flex;
  justify-content: center;
  pointer-events: none;
  // Padding "sm" ringsum
  padding: $bookando-spacing-sm;
}

.bookando-notice__content {
  // Theme-Variablen
  --bn-accent: #{$bookando-primary};
  // sehr dezent milchig + leichter Farbstich
  --bn-bg: rgba($bookando-white, 0.24);
  --bn-tint: color-mix(in srgb, var(--bn-accent) 6%, transparent);
  // feiner farbiger Rand
  --bn-border: color-mix(in srgb, var(--bn-accent) 42%, rgba($bookando-white, .45));
  --bn-shadow: 0 14px 34px rgba(16,40,60,.18);
  --bn-noise-opacity: .06; // 0–1
  --bn-noise-size: 140px;  // Kachelgrösse der Noise-Textur

  // Grid + Centering (Icon | Text | Close)
  display: grid;
  grid-template-columns: auto 1fr auto;
  align-items: center; // Text vertikal zentriert
  gap: $bookando-spacing-sm;
  position: relative;
  isolation: isolate; // für Mix-Blend (Noise)

  min-width: 320px;
  max-width: min(92vw, 560px);
  margin: 0;

  // Padding im Container
  padding: $bookando-spacing-sm $bookando-spacing-md;

  // Hintergrund + Farbverlauf (ohne linke Linie)
  background-color: var(--bn-bg);
  background-image:
    linear-gradient(180deg, rgba($bookando-white, 0.50), rgba($bookando-white, 0.18)),
    var(--bn-tint);
  background-repeat: no-repeat, no-repeat;

  // Rahmen/Shadow/Glass
  border: 1px solid var(--bn-border);
  // "Pill" auf Basis Token-Radius
  border-radius: calc(#{$bookando-radius} * 4);
  box-shadow: var(--bn-shadow);
  backdrop-filter: blur(18px) saturate(160%);
  -webkit-backdrop-filter: blur(18px) saturate(160%);
  background-clip: padding-box;

  // Interaktiv (trotz Wrapper)
  pointer-events: auto;

  // NOISE/Grain-Layer (dezent)
  &::before {
    content: '';
    position: absolute;
    inset: 0;
    border-radius: inherit;
    pointer-events: none;
    background-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='140' height='140' viewBox='0 0 140 140'><filter id='n'><feTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='2' stitchTiles='stitch'/></filter><rect width='100%' height='100%' filter='url(%23n)' opacity='0.9'/></svg>");
    background-repeat: repeat;
    background-size: var(--bn-noise-size) var(--bn-noise-size);
    mix-blend-mode: overlay;
    opacity: var(--bn-noise-opacity);
  }

  // Specular-Glanz (oben diagonal)
  &::after {
    content: '';
    pointer-events: none;
    position: absolute;
    inset: 0;
    border-radius: inherit;
    box-shadow:
      inset 1px 1px 0 rgba($bookando-white, .40),
      inset 0 0 6px rgba($bookando-white, .22);
    background:
      radial-gradient(120% 80% at -10% -10%, rgba($bookando-white,.16), transparent 60%),
      radial-gradient(120% 80% at 110% -10%, rgba($bookando-white,.07), transparent 55%);
    mix-blend-mode: soft-light;
  }

  // Close oben rechts – innerhalb des Paddings (Grid-Item)
  .bookando-notice__close {
    grid-column: 3;
    grid-row: 1;
    justify-self: end;
    align-self: start;

    background: transparent;
    border: 0;
    color: $bookando-text-muted;
    padding: 0; // innerhalb vom Container-Padding
    line-height: 0;
    cursor: pointer;

    &:hover { color: var(--bn-accent); }
    &:focus-visible {
      outline: 2px solid var(--bn-accent);
      outline-offset: 2px;
      border-radius: $bookando-radius-xs;
    }
  }

  // Runder Status-Ring (dezent)
  .bookando-notice__icon {
    grid-column: 1;
    --ring-size: 28px;
    width: var(--ring-size);
    height: var(--ring-size);
    border-radius: 9999px;
    border: 2px solid var(--bn-accent);
    display: inline-flex;
    align-items: center;
    justify-content: center;
    color: var(--bn-accent);
    background: color-mix(in srgb, var(--bn-accent) 6%, transparent);
    box-shadow: inset 0 0 0 1px rgba($bookando-white,.30);
  }

  .bookando-notice__body {
    grid-column: 2;
    min-width: 0;
  }

  .bookando-notice__header {
    font-size: $bookando-font-size-lg;
    font-weight: 700;
    margin: 0 0 $bookando-spacing-xxs 0;
    color: $bookando-heading-color;
    display: flex;
    align-items: center;
    gap: $bookando-spacing-xs;
  }

  .bookando-notice__text {
    margin: 0;
    color: $bookando-text;
  }

  // Progress-Bar entfällt explizit
  .bookando-notice__progress { display: none; }

  // Level-Modifier (setzt nur Akzent)
  &.bookando-notice--success { --bn-accent: #{$bookando-success}; }
  &.bookando-notice--warning { --bn-accent: #{$bookando-warning}; }
  &.bookando-notice--danger  { --bn-accent: #{$bookando-danger};  }
  &.bookando-notice--info    { --bn-accent: #{$bookando-primary}; }
}

// Fallback ohne Backdrop-Filter
@supports not ((-webkit-backdrop-filter: blur(2px)) or (backdrop-filter: blur(2px))) {
  .bookando-notice__content {
    --bn-bg: rgba($bookando-white, 0.85);
    background-color: var(--bn-bg);
    background-image:
      linear-gradient(180deg, rgba($bookando-white, 0.85), rgba($bookando-white, 0.70)),
      var(--bn-tint);
    border: 1px solid var(--bn-border);
  }
}

// Dark-Mode
[data-theme="dark"] .bookando-notice__content,
.form-theme-dark .bookando-notice__content {
  --bn-bg: rgba($bookando-black, 0.28);
  --bn-border: color-mix(in srgb, var(--bn-accent) 38%, rgba($bookando-white, .32));
  background-color: var(--bn-bg);
  background-image:
    linear-gradient(180deg, rgba($bookando-black, 0.46), rgba($bookando-black, 0.22)),
    var(--bn-tint);
  backdrop-filter: blur(18px) saturate(160%);
  -webkit-backdrop-filter: blur(18px) saturate(160%);
}

// Motion-Reduktion
@media (prefers-reduced-motion: reduce) {
  .bookando-notice__content { animation: none; }
}

// Admin-Bar Offset
body.admin-bar .bookando-notice {
  top: calc(var(--bookando-modal-offset, 50px) + #{$admin-bar-height-desktop});
  @media (max-width: $bookando-breakpoint-md) {
    top: calc(var(--bookando-modal-offset, 50px) + #{$admin-bar-height-mobile});
  }
}
