// _layout.scss
@use 'sass:color';
@use 'variables' as *;
@use 'mixins' as *;

// =====================================
// üß± Grid-System ‚Äì Flexibel & Responsive
// =====================================
.bookando-grid {
  display: grid;
  width: 100%;
  gap: var(--bookando-grid-gap, $bookando-spacing-md);
  grid-template-columns: var(--bookando-grid-cols, 1fr 1fr); // Dynamisch via CSS Variable

  &.align-center   { align-items: center; justify-items: center; }
  &.align-top      { align-items: start; }
  &.align-bottom   { align-items: end; }

  // Vordefinierte Fallback-Klassen (optional)
  &.one-column     { --bookando-grid-cols: 1fr; }
  &.two-columns    { --bookando-grid-cols: 1fr 1fr; }
  &.three-columns  { --bookando-grid-cols: 1fr 1fr 1fr; }
  &.four-columns   { --bookando-grid-cols: 1fr 1fr 1fr 1fr; }
  &.auto-columns   { --bookando-grid-cols: repeat(auto-fit, minmax(160px, 1fr)); }
}

// erlaubt Grid-Kindern das Schrumpfen (verhindert Ueberlauf von Multiselect-Tags)
.bookando-grid > * {
  min-width: 0; // wirkt nur auf direkte Kinder des Grid-Containers
}

// Responsives Fallback: immer 1 Spalte auf kleinerem Screen
@include respond-to('md') {
  .bookando-grid,
  .bookando-grid.two-columns,
  .bookando-grid.three-columns,
  .bookando-grid.four-columns,
  .bookando-grid.auto-columns {
    grid-template-columns: 1fr !important;
    gap: $bookando-spacing-sm;
  }
}

// =====================================
// üß≠ Page Header
// =====================================
.bookando-page-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  flex-wrap: nowrap; // Neu! Immer auf einer Linie
  gap: $bookando-spacing-sm;
  min-height: 64px;
  border-radius: $bookando-radius;

  @include respond-to('md') {
    min-height: 48px;
    // flex-wrap: nowrap; // Redundant, aber nochmal absichern
    // Kein Wechsel auf column!
  }
}

.bookando-header-left,
.bookando-header-right {
  min-width: 0;
  display: flex;
  align-items: center;
  flex-shrink: 1;
}

.bookando-module-title {
  overflow: hidden;
  white-space: nowrap;
  text-overflow: ellipsis;
  min-width: 0;
}

// =====================================
// üîñ Branding & Titel
// =====================================
.bookando-logo {
  height: 50px;
  max-height: 3rem;
  width: auto;
  object-fit: contain;
  display: inline-block;
  background: none !important;
  margin-right: $bookando-spacing-xs;
}
.bookando-brand,
.bookando-module-title {
  font-size: $bookando-font-size-lg;
  font-weight: 500;
  color: $bookando-text-dark;
  padding-left: $bookando-spacing-md;
  padding-right: $bookando-spacing-md;
  line-height: 1.2;
}
.bookando-divider {
  color: $bookando-border;
  margin-inline: $bookando-spacing-xs;
  font-weight: 400;
  font-size: 1.2em;
}

// =====================================
// üîç FilterBar-Komponente (AppFilterBar.vue)
// =====================================
.bookando-filter-bar {
  display: flex;
  flex-direction: column;
  width: 100%;                         // volle Breite
  border-radius: $bookando-radius;
  min-height: auto;
  gap: var(--fb-outer-gap, $bookando-spacing-sm);

  &-row-wrapper { width: 100%; }

  // =====================================
  // üß± Zeile (Desktop i. d. R. 1 Zeile)
  // =====================================
  &-row {
    display: flex;
    width: 100%;
    flex-wrap: nowrap;                  // kein Wrap ‚Äì die Slots steuern die Verteilung
    align-items: center;
    min-height: auto;
    gap: var(--fb-gap, $bookando-spacing-sm);

    // --- Slots (Left | Center | Right) ---
    > .bookando-filter-bar-left,
    > .bookando-filter-bar-center,
    > .bookando-filter-bar-right {
      display: flex;
      align-items: center;
      gap: var(--fb-inner-gap, $bookando-spacing-sm);
      min-width: 0;                     // ‚ùó wichtig: Shrinking ohne Overflow erlauben
    }

    // ‚öôÔ∏è Kinder der Slots d√ºrfen ebenfalls schrumpfen
    // (verhindert, dass ein einzelnes Kind den Slot aufbl√§ht)
    > .bookando-filter-bar-left   > *,
    > .bookando-filter-bar-center > *,
    > .bookando-filter-bar-right  > * {
      min-width: 0;                     // ‚ùó erlaubt Ellipsis im Kind (z. B. AppDropdown)
      max-width: 100%;
    }

    // Center-Column: darf den Inhalt clippen (Ellipsis m√∂glich)
    > .bookando-filter-bar-center {
      overflow: hidden;                 // ‚úÖ verhindert Aufbl√§hen; Voraussetzung f√ºr Ellipsis
    }

    // -------------------------------------
    // üíª Desktop-Aufteilung
    // - grow-Werte √ºber --flex-bar-*-* steuerbar (Ratios)
    // - flex-basis Fallback √ºber --fb-*-pct (Prozent)
    // - keine Max-Kappung (default: none)
    // -------------------------------------
    > .bookando-filter-bar-left {
      flex: var(--flex-bar-left, 1) 1 var(--fb-left-pct, 50%);
      max-width: var(--fb-left-max, none);
      justify-content: flex-start;
    }
    > .bookando-filter-bar-center {
      flex: var(--flex-bar-center, 1) 1 var(--fb-center-pct, 30%);
      max-width: var(--fb-center-max, none);
      justify-content: flex-start;
    }
    > .bookando-filter-bar-right {
      flex: var(--flex-bar-right, 1) 1 var(--fb-right-pct, 20%);
      max-width: var(--fb-right-max, none);
      justify-content: flex-end;
    }

    // Elemente mit .bookando-flex-fill innerhalb der Slots d√ºrfen wachsen
    > * > .bookando-flex-fill {
      flex: 1 1 0;
      min-width: 0;
      width: 100%;
    }
  }

  // -----------------------------------------
  // üîÅ Mehrspaltige Filterfl√§chen unterhalb
  // -----------------------------------------
  &-filters {
    display: flex;
    flex-wrap: wrap;
    gap: $bookando-spacing-sm;
    margin-top: $bookando-spacing-sm;
    width: 100%;
    > * { flex: 1 1 25%; min-width: 160px; }
  }
}

// -----------------------------------------
// üì± Stack-Layout (Tablet/Mobile): 2 Zeilen
//  ‚Ä¢ Row 1: left  (Suche + mobiler Filter-Button)
//  ‚Ä¢ Row 2: center (Sort) | right (Import/Export)
// -----------------------------------------
.bookando-filter-bar-stack {
  display: flex;
  flex-direction: column;
  width: 100%;
  gap: $bookando-spacing-sm;

  .bookando-filter-bar-row { width: 100%; }

  // Row 1: Suche vollbreit, keine Kappung
  .bookando-filter-bar-row:first-child > .bookando-filter-bar-left {
    flex: 1 1 100%;
    max-width: none;
    min-width: 0;
    justify-content: flex-start;
  }

  // Row 2: Verteilung per Ratio-Variablen
  .bookando-filter-bar-row:nth-child(2) > .bookando-filter-bar-center {
    flex: var(--flex-bar-center-mobile, 2) 1 0;
    min-width: 0;
    overflow: hidden;                   // ‚úÖ Ellipsis/Shrinking auch im Stack
    justify-content: flex-start;
  }
  .bookando-filter-bar-row:nth-child(2) > .bookando-filter-bar-center > * {
    min-width: 0;                       // Kinder d√ºrfen schrumpfen
    max-width: 100%;
  }
  .bookando-filter-bar-row:nth-child(2) > .bookando-filter-bar-right {
    flex: var(--flex-bar-right-mobile, 1) 1 0;
    min-width: 0;
    justify-content: flex-end;
  }
}

// =====================================
// ü™ü Overlay (AppOverlay.vue)
// =====================================
.bookando-overlay-card {
  background: $bookando-bg-gray-100;
  border-radius: $bookando-radius-sm;
  box-shadow: 0 8px 20px $bookando-shadow;
  padding: $bookando-spacing-md;
  margin: 0 auto;
  position: relative;
  width: 100%;
}

.bookando-overlay-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: $bookando-spacing-md;
  gap: $bookando-spacing-sm;
  border-bottom: 1px solid $bookando-border;
  padding-bottom: $bookando-spacing-xs;
  .overlay-title {
    font-size: $bookando-font-size-lg;
    font-weight: $bookando-font-weight-bold;
    flex: 1 1 auto;
  }
  .overlay-actions {
    display: flex;
    gap: $bookando-spacing-sm;
    align-items: center;
  }
  .overlay-close {
    margin-left: 0;
  }
}

.bookando-overlay-body {
  // Standard body-padding und styles wie gew√ºnscht
}

// =====================================
// üîç FilterOverlay-Komponente (AppFilterOverlay.vue)
// =====================================

.bookando-filter-overlay {
  max-width: 100%;
  width: 100%;
}
.bookando-filter-overlay-actions {
  margin-top: var(--bookando-space-md);
  display: flex;
  justify-content: flex-end;
  gap: var(--bookando-space-sm);
}
.bookando-filter-group {
  margin-bottom: $bookando-spacing-md;
}
.bookando-filter-group label {
  display: block;
  margin-bottom: $bookando-spacing-xs;
  font-weight: 600;
  color: $bookando-text-dark;
}
.bookando-filter-group select {
  width: 100%;
  padding: $bookando-spacing-xs $bookando-spacing-md;
  border: 1px solid $bookando-border-light;
  border-radius: $bookando-radius-sm;
  background: $bookando-bg-light;
  font-size: $bookando-font-size-base;
  color: $bookando-text;
  transition: border-color 0.2s, box-shadow 0.2s;
  &:focus {
    outline: none;
    border-color: $bookando-primary;
    box-shadow: 0 0 0 3px rgba($bookando-primary, 0.3);
  }
  &:disabled {
    background: $bookando-bg-muted;
    color: $bookando-text-muted;
    cursor: not-allowed;
  }
}
.bookando-advanced-filter-accordion {
  position: absolute;
  top: calc(100% + 8px);
  left: 0;
  right: 0;
  z-index: 30;
  background: $bookando-white;
  border-radius: $bookando-radius;
  box-shadow: 0 6px 30px rgba(16,32,55,0.14);
  padding: $bookando-spacing-lg $bookando-spacing-xl;
  margin: 0 auto;
  width: 100%;
  max-width: 1250px;
  @include respond-to('md') {
    position: fixed;
    left: 0; right: 0; top: 0;
    max-width: 100vw;
    width: 100vw;
    height: 100vh;
    border-radius: 0;
    box-shadow: none;
    overflow-y: auto;
    padding: $bookando-spacing-md $bookando-spacing-md;
    z-index: 9999;
  }
}

// =====================================
// COLUMN-CHOOSER DRAG HANDLE (zentrale Utility)
// =====================================
.bookando-drag-handle {
  cursor: grab;
  font-size: 1.15em;
  color: $bookando-gray-400;
  opacity: 0.7;
  margin-right: $bookando-spacing-xs;
  user-select: none;
  display: inline-flex;
  align-items: center;
}

// =====================================
// COLUMN-CHOOSER (Dropdown & Draggable)
// =====================================

.bookando-column-chooser-draggable {
  display: flex;
  width: 100%;
  min-height: 230px;

  .chooser-section {
    flex: 1 1 50%;
    min-width: 0;
    max-width: 100%;
    background: $bookando-bg-light;
    border-radius: $bookando-radius;
    padding: $bookando-spacing-sm $bookando-spacing-md;
    box-shadow: 0 2px 8px rgba(0,0,0,0.04);
    display: flex;
    flex-direction: column;
    align-items: stretch;
  }

  .chooser-section-title {
    font-weight: 700;
    margin-bottom: $bookando-spacing-sm;
    font-size: $bookando-font-size-lg;
    text-align: center;
  }

  .draggable-list {
    flex: 1 1 auto;
    width: 100%;
    min-height: 80px;
    list-style: none;
    padding: 0;
    margin: 0;

    .draggable-item {
      background: $bookando-white;
      border: 1px solid $bookando-border-light;
      border-radius: $bookando-radius-sm;
      margin-bottom: $bookando-spacing-xs;
      padding: $bookando-spacing-xs;
      font-size: $bookando-font-size-base;
      display: flex;
      align-items: center;
      gap: 0.35em;
      transition: background 0.13s, box-shadow 0.13s;
      box-shadow: 0 2px 7px rgba(10,25,40,0.03);

      // Standard: Button rechts
      justify-content: space-between;

      &:hover {
        background: $bookando-bg-contrast;
      }
      &.is-dragging {
        opacity: 0.58;
        background: $bookando-primary;
        color: $bookando-white;
      }
    }
  }

  // === Custom f√ºr "Versteckt" Bereich ===
  .chooser-section:last-child .draggable-list .draggable-item {
    flex-direction: row;
    justify-content: flex-end;        // Alles rechtsb√ºndig!
    gap: $bookando-spacing-md;

    .bookando-chooser-show-btn {
      margin-right: 0;
      margin-left: 0;
      color: $bookando-text;          // Standard schwarz!
      transition: color 0.15s;
      &:hover { color: $bookando-success; }
    }
    span {
      flex: 1 1 0;
      text-align: right;
    }
  }
  .chooser-section:last-child .bookando-drag-handle {
    display: none; // Kein DragHandle im "Versteckt"-Bereich
  }

  // === Custom f√ºr "Angezeigt" Bereich ===
  .chooser-section:first-child .draggable-list .draggable-item {
    flex-direction: row;
    justify-content: flex-start;      // Alles linksb√ºndig!
    gap: $bookando-spacing-md;

    .bookando-chooser-hide-btn {
      margin-left: auto;
      margin-right: 0;
      color: $bookando-text;          // Standard schwarz!
      transition: color 0.15s;
      &:hover { color: $bookando-danger; }
    }
    span {
      flex: 1 1 0;
      text-align: left;
    }
  }

  .chooser-separator {
    width: 5px;
    min-width: 5px;
    border-radius: 4px;
    background: $bookando-border;
    margin: 0 1em;
    align-self: stretch;
  }

  @include respond-to('md') {
    flex-direction: column;
    .chooser-separator { display: none; }
  }

}
