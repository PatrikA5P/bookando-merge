# Internationalisierung

Dieses Dokument fasst die verbindlichen Regeln für Übersetzungen im Bookando
Plugin zusammen. Ziel ist ein konsistentes Vorgehen über REST-API, Vue-Frontend
und Build-Pipeline hinweg.

## REST-API

* Alle nutzer:innen-sichtbaren Texte in `Api`-Klassen und `RestHandler`
  **müssen** über die WordPress-Helfer `__()` oder `_x()` übersetzt werden.
* Für Parameterbeschreibungen und vergleichbare Metadaten wird `_x()` mit einem
  aussagekräftigen Kontext verwendet, z. B.
  ```php
  _x('Customer ID', 'REST parameter description', 'bookando');
  ```
* Fehlermeldungen und Status-Texte nutzen `__()` mit dem Textdomain
  `bookando`.
* Machine-readable Werte wie Slugs, IDs oder Flags bleiben unübersetzt.

Zur Absicherung existiert das Skript
`scripts/check-rest-i18n.mjs`, das im CI-Check `npm run lint:i18n` enthalten
ist. Es sucht nach Klartext-Strings in REST-Antworten, Parametern und
`WP_Error`-Instanzen und schlägt fehl, wenn keine Übersetzungsfunktion gefunden
wird.

## Frontend (Vue)

* Jeder Modul-Client in `src/modules/*/assets/vue` besitzt eine Datei
  `i18n.local.ts` (bzw. `.js`). Die dort deklarierten `messages` werden zur
  zentralen Core-Lokalisierung gemerged.
* Modul-spezifische Keys verwenden das Namensschema
  `mod.{slug}.{bereich}` (`mod.settings.cards.general.title`, …).
* Fehlende Keys müssen ergänzt werden, damit `i18n:locale-audit` ohne
  Warnungen durchläuft.

### Modul-Lokalisierungen

| Modul        | Datei                                              | Sprachen                     |
| ------------ | -------------------------------------------------- | ---------------------------- |
| Academy      | `src/modules/academy/assets/vue/i18n.local.ts`     | `de`, `en`, `fr`, `it`, `es` |
| Appointments | `src/modules/appointments/assets/vue/i18n.local.ts` | `de`, `en`, `fr`, `it`, `es` |
| Customers    | `src/modules/customers/assets/vue/i18n.local.ts`   | `de`, `en`, `fr`, `it`, `es` |
| Employees    | `src/modules/employees/assets/vue/i18n.local.ts`   | `de`, `en`, `fr`, `it`, `es` |
| Finance      | `src/modules/finance/assets/vue/i18n.local.ts`     | `de`, `en`, `fr`, `it`, `es` |
| Offers       | `src/modules/offers/assets/vue/i18n.local.ts`      | `de`, `en`, `fr`, `it`, `es` |
| Resources    | `src/modules/resources/assets/vue/i18n.local.ts`   | `de`, `en`, `fr`, `it`, `es` |
| Settings     | `src/modules/settings/assets/vue/i18n.local.ts`    | `de`, `en`, `fr`, `it`, `es` |

* Die deutschen Übersetzungen dienen als Referenzstruktur. Alle weiteren
  Sprachen müssen identische Schlüssel liefern (Inhalte dürfen natürlich
  übersetzt werden).
* Neue Module übernehmen das gleiche Muster (`messages.de` als Basis,
  anschließend alle offiziell unterstützten Sprachen aus `@core/Design/i18n`).

## Lokalisierungs-Checks & CI

Der kombinierte Übersetzungscheck besteht aus zwei Schritten und kann lokal wie
in CI mit folgendem Kommando ausgeführt werden:

```bash
npm run lint:i18n
```

1. `npm run lint:i18n:php` → führt `scripts/check-rest-i18n.mjs` aus und stellt
   sicher, dass REST-Layer keine nicht lokalisierten Strings enthalten.
2. `npm run lint:i18n:vue` → ruft `npm run i18n:locale-audit` auf und prüft
   Vue-Komponenten auf fehlende Keys.
3. `npm run test` → führt neben den bestehenden Vitest-Suites auch den
   Abdeckungscheck `src/modules/i18n.local.test.ts` aus. Dieser stellt sicher,
   dass jedes Modul für alle konfigurierten Sprachen Übersetzungswerte
   bereitstellt.

Beide Schritte liefern einen Fehlercode ≠ 0, wenn Verstöße gefunden werden und
können damit direkt in Build-Pipelines integriert werden.

## Übersetzungsartefakte erzeugen

Für PHP- und JavaScript-Strings existieren Composer-Skripte, die die POT- bzw.
MO-Dateien aktualisieren:

```bash
composer run i18n:pot
composer run i18n:mo
```

Falls der WP-CLI-Befehl lokal nicht zur Verfügung steht, kann alternativ das
Node-Skript `node scripts/extract-php-i18n.mjs` genutzt werden. Es extrahiert
sämtliche PHP-Strings mit der Textdomain `bookando` und schreibt die aktualisierte
`languages/bookando.pot` direkt ins Repository.

Vor einem Release sollten alle Lokalisierungsprüfungen erfolgreich sein und die
Sprachdateien aktualisiert werden.

## Aktualisierte WordPress-Texte (Stand 2025-11-09)

Die aktuelle POT-Datei enthält neue Texte für

* das Admin-Aktivitätslog (`src/Core/Admin/LogsPage.php`),
* Modulnamen und CRUD-Rückmeldungen der REST-Handler (`src/modules/*/RestHandler.php`),
* REST-Fehlermeldungen und Parameterbeschreibungen (`src/Core/Dispatcher`, `src/modules/*/Api/Api.php`).

Die entsprechenden Einträge sind in `languages/bookando-de_DE.po` und
`languages/bookando-en_US.po` bereits angelegt und können jetzt übersetzt werden.
